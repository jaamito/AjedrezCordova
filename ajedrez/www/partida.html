<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <!--<meta http-equiv="Content-Security-Policy" content="
        default-src &apos;self&apos; data: gap: https://ssl.gstatic.com &apos;unsafe-eval&apos;;
        style-src &apos;self&apos; &apos;unsafe-inline&apos;;
        media-src *;
        img-src &apos;self&apos; data: content:;
        script-src * &apos;unsafe-eval&apos; &apos;unsafe-inline&apos;;
        connect-src * &apos;unsafe-eval&apos; &apos;unsafe-inline&apos;;">-->
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="stylesheet" type="text/css" href="css/index.css">
		<link rel="stylesheet" type="text/css" href="js/jquery-1.5.0.mobile.min.css">
        <title>Hello World</title>
    </head>
    <body>
        <div class="app">
            <a href="http://localhost:8001/inicio.html">Volver al Inicio</a>
            <!-- Pagina 3 -->
                <h4>Hola estas dentro de una partida</h4>
                <ul>
                    <li id="token" ></li>
                    <li id="nombre"></li>
                    <li id="idPartida"></li>
                    <li id="users"></li>
                </ul>
                <h2>Partida </h2>
                <table width="200" align="center">
                    <tr>
                      <th width="32" scope="col"><img src="blanco.jpg" name="t1" width="30" height="30" onClick="PonerFicha('t1',1,0)"></th>
                      <th width="30" scope="col"><img name="t2" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t2',0,1)"></th>
                      <th width="30" scope="col"><img name="t3" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t3',1,2)"></th>
                      <th width="30" scope="col"><img name="t4" src="rey_en_blanco.gif" width="30" height="30" onClick="PonerFicha('t4',0,3)"></th>
                      <th width="30" scope="col"><img name="t5" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t5',1,4)"></th>
                      <th width="20" scope="col"><img name="t6" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t6',0,5)"></th>
                      <th width="20" scope="col"><img name="t7" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t7',1,6)"></th>
                      <th width="20" scope="col"><img name="t8" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t8',0,7)"></th>
                    </tr>
                    <tr>
                      <td><img name="t9" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t9',0,8)"></td>
                      <td><img name="t10" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t10',1,9)"></td>
                      <td><img name="t11" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t11',0,10)"></td>
                      <td><img name="t12" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t12',1,11)"></td>
                      <td><img name="t13" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t13',0,12)"></td>
                      <td><img name="t14" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t14',1,13)"></td>
                      <td><img name="t15" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t15',0,14)"></td>
                      <td><img name="t16" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t16',1,15)"></td>
                    </tr>
                    <tr>
                      <td><img name="t17" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t17',1,16)"></td>
                      <td><img name="t18" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t18',0,17)"></td>
                      <td><img name="t19" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t19',1,18)"></td>
                      <td><img name="t20" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t20',0,19)"></td>
                      <td><img name="t21" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t21',1,20)"></td>
                      <td><img name="t22" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t22',0,21)"></td>
                      <td><img name="t23" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t23',1,22)"></td>
                      <td><img name="t24" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t24',0,23)"></td>
                    </tr>
                    <tr>
                      <td><img name="t25" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t25',0,24)"></td>
                      <td><img name="t26" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t26',1,25)"></td>
                      <td><img name="t27" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t27',0,26)"></td>
                      <td><img name="t28" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t28',1,27)"></td>
                      <td><img name="t29" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t29',0,28)"></td>
                      <td><img name="t30" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t30',1,29)"></td>
                      <td><img name="t31" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t31',0,30)"></td>
                      <td><img name="t32" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t32',1,31)"></td>
                    </tr>
                    <tr>
                      <td><img name="t33" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t33',1,32)"></td>
                      <td><img name="t34" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t34',0,33)"></td>
                      <td><img name="t35" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t35',1,34)"></td>
                      <td><img name="t36" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t36',0,35)"></td>
                      <td><img name="t37" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t37',1,36)"></td>
                      <td><img name="t38" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t38',0,37)"></td>
                      <td><img name="t39" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t39',1,38)"></td>
                      <td><img name="t40" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t40',0,39)"></td>
                    </tr>
                    <tr>
                      <td><img name="t41" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t41',0,40)"></td>
                      <td><img name="t42" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t42',1,41)"></td>
                      <td><img name="t43" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t43',0,42)"></td>
                      <td><img name="t44" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t44',1,43)"></td>
                      <td><img name="t45" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t45',0,44)"></td>
                      <td><img name="t46" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t46',1,45)"></td>
                      <td><img name="t47" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t47',0,46)"></td>
                      <td><img name="t48" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t48',1,47)"></td>
                    </tr>
                    <tr>
                      <td><img name="t49" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t49',1,48)"></td>
                      <td><img name="t50" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t50',0,49)"></td>
                      <td><img name="t51" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t51',1,50)"></td>
                      <td><img name="t52" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t52',0,51)"></td>
                      <td><img name="t53" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t53',1,52)"></td>
                      <td><img name="t54" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t54',0,53)"></td>
                      <td><img name="t55" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t55',1,54)"></td>
                      <td><img name="t56" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t56',0,55)"></td>
                    </tr>
                    <tr>
                      <th width="32" scope="col"><img name="t57" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t57',0,56)"></th>
                      <th width="30" scope="col"><img name="t58" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t58',1,57)"></th>
                      <th width="30" scope="col"><img name="t59" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t59',0,58)"></th>
                      <th width="30" scope="col"><img name="t60" src="rey_en_blanco.gif" width="30" height="30" onClick="PonerFicha('t60',1,59)"></th>
                      <th width="30" scope="col"><img name="t61" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t61',0,60)"></th>
                      <th width="20" scope="col"><img name="t62" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t62',1,61)"></th>
                      <th width="20" scope="col"><img name="t63" src="negro.jpg" width="30" height="30" onClick="PonerFicha('t63',0,62)"></th>
                      <th width="20" scope="col"><img name="t64" src="blanco.jpg" width="30" height="30" onClick="PonerFicha('t64',1,63)"></th>
                    </tr>
                  </table>
                <a href="http://localhost:8001/index.html">Logout</a>

        </div>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            document.getElementById("nombre").innerHTML = localStorage.getItem("nombre");
            document.getElementById("token").innerHTML = localStorage.getItem("token");
            document.getElementById("idPartida").innerHTML = localStorage.getItem("idPartida");
            document.getElementById("users").innerHTML = localStorage.getItem("idUser");
            //user 1

            if(localStorage.getItem("idUser") == "1"){
                var idparti = localStorage.getItem("idPartida");
                url = 'http://localhost:8000/api/movimiento/'+idparti;
                $.ajax({
                    type: "GET",
                    url:url,
                    dataType: 'json',
                    timeout: 5000,
                }).done(function( data, textStatus, jqXHR ) {//data van los datos
                    if ( console && console.log ) {
                        //Bien has salido!
                        var ultpos =  parseInt(data["ultpos1"]);//guarda la ultima posicion de la ficha
                        var ultficha = parseInt(data["ultficha1"]);//guarda el ultimo color de cuadro donde estuvo la ficha
                        var ultname = data["ultname1"];
                    }
                }).fail(function( jqXHR, textStatus, errorThrown) {
                    if ( console && console.log ) {
                        console.log( "La solicitud a fallado:" +  textStatus);
                    }
                });
            //user 2
            }else{
                var ultpos=59 //guarda la ultima posicion de la ficha
                var ultficha=1 //guarda el ultimo color de cuadro donde estuvo la ficha
                var ultname="t60" //guarda el ultimo nombre del atributo imagen
            }
            //User 1
            function PonerFicha(name,ficha,posicion) {
               //Comprovamos los movimientos legales
               if (ComprobarMov(ultpos,posicion)){ 
                 if (ultficha==0)
                    document.images[ultname].src = "negro.jpg"
                 if (ultficha==1)
                    document.images[ultname].src = "blanco.jpg"
                 if (ficha==0)
                    document.images[name].src = "rey_en_negro.gif"
                 if (ficha==1)
                    document.images[name].src = "rey_en_blanco.gif"
                ultpos=posicion
                ultname=name
                ultficha=ficha
                console.log("ultname: "+ultname);
                console.log("ultficha: "+ultficha);
                console.log("ultpos: "+ultpos);
                /*
                url = 'http://localhost:8000/api/movimiento/'++'/'+;
                $.ajax({
                    type: "GET",
                    url:url,
                    dataType: 'json',
                    timeout: 5000,
                }).done(function( data, textStatus, jqXHR ) {//data van los datos
                    if ( console && console.log ) {
                        console.log(data["mensaje"]);//Bien has salido!
                    }
                }).fail(function( jqXHR, textStatus, errorThrown) {
                    if ( console && console.log ) {
                        console.log( "La solicitud a fallado:" +  textStatus);
                    }
                });
                */
                }
                else
                    alert('Movimiento Ilegal!!')
            }
            //logica de la ficha
            function ComprobarMov(ant,pos){
              //Extremos Derechos
              if (ant==7 || ant==15 || ant==23 || ant==31 || ant==39 || ant==47 || ant==55 || ant==63){
                //Para Delante
                if (pos==ant+7 || pos==ant+8)
                    return true
              //De Retroceso
                if (pos==ant-1 || pos==ant-8|| pos==ant-9)
                    return true
                return false
              } 
              //Extremos Izquierdos
              if (ant==0 || ant==8 || ant==16 || ant==24 || ant==32 || ant==40 || ant==48 || ant==56){
                //Para Delante
                if (pos==ant+1 || pos==ant+8 || pos==ant+9)
                    return true
              //De Retroceso
                if (pos==ant-7 || pos==ant-8)
                    return true
                return false
              } 
              //Demas Pocisiones
              if (pos==ant+1 || pos==ant+7 || pos==ant+8|| pos==ant+9)
                return true
              //De Retroceso
              if (pos==ant-1 || pos==ant-7 || pos==ant-8|| pos==ant-9)
                return true
              return false
            }
        </script>
    </body>
</html>
